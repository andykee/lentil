************
Focal Planes
************

Focal Plane Classes
===================

Quantum Efficiency and Gain
===========================


Dark Current
============


Random Noise Sources
====================



Fixed Pattern Noise
===================



Defects and Cosmic Rays
=======================

Subclassing FPA
===============


Lentil's `detector <../api.html#detector>`_  module provides classes for representing
both panchromatic and multispectral (Bayer) imaging sensors and many of their common
noise sources including

* Shot noise due to randomness in the arrival and detection of photons
* The conversion of photons into electrons (quantum efficiency)
* Dark current due to thermally generated electrons inside each pixel
* Spatial nonuniformity due to variations in detector pixels and electronics
* Noise generated by the electronics which read out the pixel values
* Pixel defects like hot or dead pixels, and other imaging artifacts like cosmic ray
  strikes

The :class:`~lentil.detector.FPA` class is the base class for building models of
panchromatic imaging sensors. This class implements mathematical models of both single
pixels and the entire array of pixels. These models are used together to simulate a
digital image (including noise) produced by the imaging sensor given some photon flux.

Signal Flow
===========
The full signal flow through Lentil's FPA model is depicted in the figure below.

.. image:: ../_static/img/detector_model.png
    :width: 800px
    :align: center

The signal can be split into two primary groups:

* A light signal representing the irrandiance (photons/s/px) presented to the detector.
  Note that the light signal represents **all** sources of photon flux which may include
  near field (self-emission) contributions in addition to the scene being observed.
* A dark signal representing all other sources of electrons present in the detector that
  aren't due to the light signal. These sources include thermally generated dark current
  and any voltage offsets.

Various noise sources also contribute to the eventual digital signal read out by the
detector. These noise sources can be broadly classified into two groups:

* Fixed-pattern noise is time-invariant and does not change from frame to frame. Fixed
  pattern noise can be thought of as a characteristic of the detector
* Temporal noise varies from frame to frame and typically represents random processes in t
  he detection and readout of an image

An Ideal Imaging Sensor
=======================
In the ideal (noise-free) case, every photon that strikes a pixel will result in the
accumulation of an electron in the pixel well (QE = 1). The electrons in each pixel are
converted to a voltage (up to some saturation point), amplified, and converted to a
digital signal by an ADC. If we assume this process is linear, it can be described by a
single gain term relating electrons to DN.

The simplest functional model requires the definition of a few basic sensor attributes:

* Pixel size
* Quantum efficiency
* The conversion gain from e- to DN
* The saturation capacity of a single pixel in e-

The model below provides a sample implementation of the ideal imaging sensor described
above

.. code-block:: python3

    import lentil

    class IdealFPA(lentil.FPA):
        def __init__(self):
            self.pixelscale = (5e-6, 5e-6)
            self.qe = 1
            self.gain = lentil.detector.Gain(gain=25, saturation_capacity=10000)


Constructing a photon flux array
--------------------------------

